<!-- 
  Copyright 2023 lspriv. All Rights Reserved.
  Distributed under MIT license.
  See File LICENSE for detail or copy at https://opensource.org/licenses/MIT
 -->
<wxs src="../wxs/tool.wxs" module="tool_wxs" />
<wxs src="../wxs/transform.wxs" module="trans_wxs" />
<view 
  id="panel"
  class="wc__panel"
  data-view="{{ currView }}"
  data-main="{{ layout.mainHeight }}"
  data-max="{{ layout.maxHeight }}"
  data-min="{{ layout.minHeight }}"
  change:view="{{ trans_wxs.viewChange }}" view="{{ currView }}"
  change:offset="{{ trans_wxs.offsetChange }}" offset="{{ offsetChange }}"
  change:initView="{{ trans_wxs.initViewChange }}" initView="{{ initView }}"
  change:transView="{{ trans_wxs.transViewChange }}" transView="{{ transView }}"
  bind:touchstart="{{ trans_wxs.touchStart }}"
  catch:touchmove="{{ trans_wxs.touchMove }}" 
  catch:touchend="{{ trans_wxs.touchEnd }}"
  catch:transitionend="calendarTransitionEnd">
  <swiper 
    circular 
    duration="{{ 300 }}" 
    current="{{ current }}" 
    class="wc__panel-swiper"
    data-type="panel"
    bind:transition="swiperTrans"
    bind:animationfinish="swiperTransEnd">
    <swiper-item
      wx:for="{{ panels }}" 
      wx:for-item="panel" 
      wx:for-index="pdx"
      wx:key="key"
      skip-hidden-item-layout>
      <view 
        class="
          wc__panel-container 
          {{ current === pdx ? 'wc__panel-container--current' : 'wc__panel-container--incurrent' }}
          wc__panel-container--wl-{{ panel.weeks.length }}
          {{ currView === 'week' ? 'wc__panel-container--hidden' : '' }}
        "
        data-offset="{{ panel.offset }}"
        data-wdx="{{ panel.wdx }}"
        >
        <view
          wx:if="{{ current === pdx && pointer && pointer.show }}"
          class="wc__panel-pointer {{ checked.today ? 'wc__panel-pointer--today' : '' }} {{ pointer.animate ? 'wc__panel-pointer--animate' : '' }}"
          style="top: {{ pointer.y }}; left: {{ pointer.x }};">
          <view 
            class="wc__panel-pointer-inner {{ pointer.animate ? 'wc__panel-pointer-inner--animate' : '' }}" 
            bind:animationend="handlePointerAnimated"></view>
        </view>
        <view  
          wx:for="{{ panel.weeks }}" 
          wx:for-item="week" 
          wx:for-index="wdx"
          wx:key="key"
          class="wc__panel-week {{ panel.weeks.length > 5 && (wdx === panel.wdx + 1) ? 'wc__panel-week--next' : '' }}">
          <view 
            wx:for="{{ week.days }}" 
            wx:for-item="day" 
            wx:for-index="ddx"
            wx:key="key"
            mark:wdx="{{ wdx }}"
            mark:ddx="{{ ddx }}"
            class="
              wc__panel-date
              wc__panel-date--{{ day.kind }} 
              {{ day.today ? 'wc__panel-date--today' : '' }}
              {{ tool_wxs.isChecked(pointer, day, checked) ? 'wc__panel-date--checked' : '' }}
              {{ day.schedules.length ? 'wc__panel-date--scheduled' : '' }}
            ">
            <view class="wc__panel-day" style="{{ day.style }}" catch:tap="selDate">
              <view 
                class="wc__panel-solar" 
                style="{{ day.solar ? day.solar.style : '' }}">{{ day.solar ? day.solar.text : day.day }}<view 
                wx:if="{{ day.corner }}"
                class="wc__panel-corner"
                style="{{ day.corner.style }}">{{ day.corner.text }}</view></view>
              <view 
                wx:if="{{ day.mark || alignDate === 'baseline' }}"
                class="wc__panel-mark" 
                style="{{ day.mark.style }}">{{ day.mark.text }}</view>
            </view>
            <view 
              wx:if="{{ day.schedules.length && current === pdx || currView == 'schedule'  }}" 
              class="wc__panel-schedules">
              <view 
                wx:for="{{ tool_wxs.cutSchedules(day.schedules, panel.weeks.length, layout.maxScheduleSize) }}" 
                wx:for-index="sdx"
                wx:for-item="schedule"
                wx:key="key"
                style="{{ schedule.style }}"
                class="wc__panel-schedule"
                data-sdx="{{ sdx }}"
                catch:tap="selSchedule">{{ schedule.text }}</view>
              <view 
                wx:if="{{ tool_wxs.scheduleShowRest(day.schedules, panel.weeks.length, layout.maxScheduleSize) }}" 
                class="wc__panel-schedule wc__panel-schedule--more"
                data-all
                catch:tap="selSchedule"
              >+{{ tool_wxs.scheduleRest(day.schedules, panel.weeks.length, layout.maxScheduleSize) }}</view>
            </view>
          </view>
        </view>
      </view>
    </swiper-item>
  </swiper>
</view>